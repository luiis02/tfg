#include <WiFi.h>
#include <WiFiUdp.h>

// Configura los detalles de la red WiFi
const char* ssid = "TP-Link_C7D4";
const char* password = "56027563";


const char* serverIp = "192.168.0.2"; // Cambia esta IP por la de tu servidor
const unsigned int serverPort = 12345;  // Cambia este puerto si es necesario

WiFiUDP udp;
const int analogPin = 34; // Pin ADC del ESP32 donde está conectado el micrófono

const int sampleRate = 16000; // Frecuencia de muestreo (16 kHz)
const int samplesPerPacket = 512; // Número de muestras por paquete
int16_t audioBuffer[samplesPerPacket];

void setup() {
  Serial.begin(115200);
  WiFi.begin(ssid, password);

  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.println("Conectando a WiFi...");
  }

  Serial.println("Conectado a WiFi");
}

void loop() {
  for (int i = 0; i < samplesPerPacket; i++) {
    int analogValue = analogRead(analogPin);
    audioBuffer[i] = analogValue;
    delayMicroseconds(1000000 / sampleRate);
  }

  udp.beginPacket(serverIp, serverPort);
  udp.write((uint8_t*)audioBuffer, sizeof(audioBuffer));
  udp.endPacket();
}
