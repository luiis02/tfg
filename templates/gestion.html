{% extends "base.html" %}
{% block title %}
Gestionar secciones
{% endblock %}

{% block content %}
    <main>
        <div class="breadcrums">
            <a href="{{ base_domain }}/dashboard" class="e1">Home</a>
            <p class="next"> ➤</p> <a href="" class="e2">Actual</a>
        </div>
        <div id="1">
            <div>
                <h2>Filtrar por categoría:</h2>
                <select name="lenguaje">
                    <option value="python">Python</option>
                    <option value="java">Java</option>
                    <option value="javascript">JavaScript</option>
                    <option value="csharp">C#</option>
                </select>
            </div>

            <div class="recuadro-tabla">
                <table>
                    <thead>
                        <tr>
                            <th>Nª </th>
                            <th>Hora</th>
                            <th>Nombre del plato</th>
                            <th>Cantidad</th>
                            <th>Categoría</th>
                            <th>Mesa</th>
                            <th>Check</th>
                        </tr>
                    </thead>
                    <tbody>

                        <tr></tr>
                        {% for pedido in pedidos %}
                        <tr>
                            
                            <td>{{ pedido.id }}</td>
                            <td>{{ pedido.fecha }}</td>
                            <td>{{ pedido.plato }}</td>
                            <td>{{ pedido.cantidad }}</td>
                            <td></td>
                            <td>{{ pedido.mesa}}</td>
                            <td>
                                <button onclick="enviarEstado('{{ pedido.id }}', 'fin')">Finalizado</button>
                                <button onclick="enviarEstado('{{ pedido.id }}', 'error')">Error</button>
                            </td>
                            

                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

        </div>




    </main>
    {% endblock %}
    {% block scriptjs %}
    <script src="{{ url_for('static', filename='js/carta.js') }}"></script>

    <script>
    function enviarEstado(idPedido, estado) {
            const datos = {
                id: idPedido,
                estado: estado
            };

            fetch('/gestion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(datos)
            })
            .then(response => {
                if (response.ok) {
                    console.log(`Estado del pedido ${idPedido} actualizado a ${estado}`);
                } else {
                    console.error('Error al actualizar el estado del pedido');
                }
            })
            .catch(error => {
                console.error('Error en la solicitud:', error);
            });
        }

    </script>

    {% endblock %}
